<!doctype html><html lang=ko dir=ltr><head><title>리액트에서 이미지 마스킹하기 :: Hun's Blog ✍️ - 프론트엔드 개발자 성장기</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="<Button variant=&#34;contained&#34; component=&#34;label&#34;> 아이콘 업로드 <input accept=&#34;image/*&#34; multiple type=&#34;file&#34; hidden onChange={(e: ChangeEvent<HTMLInputElement>): void => handleUploadIcon(e)} /> </Button> 먼저, 업로드 버튼을 만들고, 모든이미지를 허용하고, file타입으로 input태그를 만든다.
const handleUploadIcon = (e: ChangeEvent<HTMLInputElement>) => { setImgFile(e.target.files[0]) const imagePromise = e.target.files[0].arrayBuffer().then((buf) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string // //! 아이콘 해쉬 변환 const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } makeImage함수로 이미지를 masking 그리고, dataURLtoFile 함수로 파일객체로 만들어준다.
useEffect(() => { if (imgFile) { const imagePromise = imgFile.arrayBuffer().then((buf: ArrayBuffer) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized: Blob) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } }, [borderImgState, borderColor]) useEffect(() => { if (icon && file) { dispatch(setInfo(file, 'uploadFile')) dispatch(setInfo(borderImg, 'borderImgState')) dispatch(setInfo(borderColor, 'borderColor')) } }, [icon, file]) border가 바뀔때마다, 그리고 img가 바뀔때마다, masking 함수를 실행한다.
"><meta name=keywords content="Javascript,React"><meta name=robots content="noodp"><link rel=manifest href=/manifest.json><meta property="og:url" content="https://findmytrueself.github.io/ko/frontend/imgmask/"><meta property="og:site_name" content="Hun's Blog ✍️"><meta property="og:title" content="리액트에서 이미지 마스킹하기"><meta property="og:description" content="<Button variant=&#34;contained&#34; component=&#34;label&#34;> 아이콘 업로드 <input accept=&#34;image/*&#34; multiple type=&#34;file&#34; hidden onChange={(e: ChangeEvent<HTMLInputElement>): void => handleUploadIcon(e)} /> </Button> 먼저, 업로드 버튼을 만들고, 모든이미지를 허용하고, file타입으로 input태그를 만든다.
const handleUploadIcon = (e: ChangeEvent<HTMLInputElement>) => { setImgFile(e.target.files[0]) const imagePromise = e.target.files[0].arrayBuffer().then((buf) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string // //! 아이콘 해쉬 변환 const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } makeImage함수로 이미지를 masking 그리고, dataURLtoFile 함수로 파일객체로 만들어준다.
useEffect(() => { if (imgFile) { const imagePromise = imgFile.arrayBuffer().then((buf: ArrayBuffer) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized: Blob) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } }, [borderImgState, borderColor]) useEffect(() => { if (icon && file) { dispatch(setInfo(file, 'uploadFile')) dispatch(setInfo(borderImg, 'borderImgState')) dispatch(setInfo(borderColor, 'borderColor')) } }, [icon, file]) border가 바뀔때마다, 그리고 img가 바뀔때마다, masking 함수를 실행한다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="frontend"><meta property="article:published_time" content="2022-05-30T18:26:25+09:00"><meta property="article:modified_time" content="2022-05-30T18:26:25+09:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="React"><meta name=twitter:card content="summary"><meta name=twitter:title content="리액트에서 이미지 마스킹하기"><meta name=twitter:description content="<Button variant=&#34;contained&#34; component=&#34;label&#34;> 아이콘 업로드 <input accept=&#34;image/*&#34; multiple type=&#34;file&#34; hidden onChange={(e: ChangeEvent<HTMLInputElement>): void => handleUploadIcon(e)} /> </Button> 먼저, 업로드 버튼을 만들고, 모든이미지를 허용하고, file타입으로 input태그를 만든다.
const handleUploadIcon = (e: ChangeEvent<HTMLInputElement>) => { setImgFile(e.target.files[0]) const imagePromise = e.target.files[0].arrayBuffer().then((buf) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string // //! 아이콘 해쉬 변환 const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } makeImage함수로 이미지를 masking 그리고, dataURLtoFile 함수로 파일객체로 만들어준다.
useEffect(() => { if (imgFile) { const imagePromise = imgFile.arrayBuffer().then((buf: ArrayBuffer) => { return makeImage(buf, figure, borderColor) }) imagePromise.then((resized: Blob) => { const fileReader = new FileReader() fileReader.readAsDataURL(resized) fileReader.onload = (e) => { const image = new Image() image.src = e.target.result as string image.onload = () => { const base64Img = e.target.result as string const hash = CryptoJS.SHA256(base64Img).toString() const file = dataURLtoFile(base64Img, 'MaskedImage.png') dispatch(setInfo(base64Img, 'base64Img')) dispatch(setInfo(hash, '아이콘 추가')) setFile(file) } } }) } }, [borderImgState, borderColor]) useEffect(() => { if (icon && file) { dispatch(setInfo(file, 'uploadFile')) dispatch(setInfo(borderImg, 'borderImgState')) dispatch(setInfo(borderColor, 'borderColor')) } }, [icon, file]) border가 바뀔때마다, 그리고 img가 바뀔때마다, masking 함수를 실행한다."><link rel=canonical href=https://findmytrueself.github.io/ko/frontend/imgmask/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/index.min.c860e17f20d9f258820c02bf7ab3f57c9595d0bc21dede7eda08ccd63ba3f4cc.css></head><body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800"><header class="flex flex-none justify-center z-10"><div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3"><div class="flex-none ml-2 md:ml-0"><a href=/ko/><img class="h-12 w-12 rounded-full object-cover bg-gray-100" src=/images/gamer.png alt=logo></a></div><div class=flex-1></div><div class=flex-none><nav class="h-full static"><button id=navbar-menu-toggle type=button class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls=navbar-menu aria-expanded=false>
<span class=sr-only>메뉴 열기</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg></i></button><div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id=navbar-menu><ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-sm md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5"><li id=ALGORITHM><a class="block px-3 py-3 hover:text-emerald-600" href=/ko/algorithm title=ALGORITHM>ALGORITHM</a></li><li id=BLOCKCHAIN><a class="block px-3 py-3 hover:text-emerald-600" href=/ko/blockchain title=BLOCKCHAIN>BLOCKCHAIN</a></li><li id=FRONTEND><a class="block px-3 py-3 hover:text-emerald-600" href=/ko/frontend title=FRONTEND>FRONTEND</a></li><li id=DIARY><a class="block px-3 py-3 hover:text-emerald-600" href=/ko/diary title=DIARY>DIARY</a></li><li id=Résumé.pdf><a class="block px-3 py-3 hover:text-emerald-600" href=/pdfs/3%EB%85%84%EC%B0%A8_%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C_%EC%9E%84%ED%9B%88.pdf title=Résumé.pdf>Résumé.pdf</a></li></ul></div></nav></div><div class=flex-none><div class="h-full static"><button id=navbar-lang-toggle type=button class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls=navbar-menu aria-expanded=false>
<span class=sr-only>언어 선택기 열기</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-language" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c0 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg></i></button><div class="absolute hidden top-16 z-50" id=navbar-lang><ul class="flex flex-col rounded-sm px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5"><li><span class="block px-3 py-3 cursor-default hover:text-emerald-600">한국어</span></li><li><a class="block px-3 py-3 hover:text-emerald-600" href=/en/frontend/imgmask/ title=English>English</a></li></ul></div></div></div><div class="flex-none md:hidden"><a href=/ko/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls=navbar-menu aria-expanded=false><span class=sr-only>검색</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1014 0A7 7 0 103 10"/><path d="M21 21l-6-6"/></svg></i></a></div><div class="darkmode-toggle flex flex-none mr-2 md:mr-0"><label for=darkmode-toggle class="flex items-center px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="다크 모드 전환"><input name=darkmode-toggle id=darkmode-toggle type=checkbox class="sr-only peer" aria-label="다크 모드 전환"><div class="group flex flex-row gap-1 justify-center h-8 px-1 rounded-full bg-white dark:bg-gray-700"><i class="h-6 w-6 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:group-[]:invisible"><svg class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M12 5v.01"/><path d="M17 7v.01"/><path d="M19 12v.01"/><path d="M17 17v.01"/><path d="M12 19v.01"/><path d="M7 17v.01"/><path d="M5 12v.01"/><path d="M7 7v.01"/></svg>
</i><i class="h-6 w-6 flex-none rounded-full place-self-center invisible peer-checked:group-[]:visible"><svg class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/><path d="M17 4a2 2 0 002 2 2 2 0 00-2 2 2 2 0 00-2-2 2 2 0 002-2"/><path d="M19 11h2m-1-1v2"/></svg></i></div></label></div></div></header><main class="flex flex-auto justify-center"><div class="w-full max-w-4xl lg:max-w-5xl"><div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700"><div><a href=/ko/frontend/imgmask/></a></div><div class="flex flex-col gap-y-3 p-6"><h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100"><a href=/ko/frontend/imgmask/>리액트에서 이미지 마스킹하기</a></h1><ul class="flex flex-row flex-wrap text-slate-500 dark:text-slate-300"><li><a href=/ko/tags/javascript/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Javascript</span></a></li><li><a href=/ko/tags/react/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>React</span></a></li></ul><div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300"><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/><path d="M16 3v4"/><path d="M8 3v4"/><path d="M4 11h16"/><path d="M11 15h1"/><path d="M12 15v3"/></svg>
</i><time datetime=2022-05-30T18:26:25+09:00>2022-05-30</time></div><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.5 7h11"/><path d="M6 20v-2a6 6 0 1112 0v2a1 1 0 01-1 1H7a1 1 0 01-1-1z"/><path d="M6 4v2a6 6 0 1012 0V4a1 1 0 00-1-1H7A1 1 0 006 4z"/></svg>
</i><span>읽는 시간 4분</span></div></div><section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6"><h2>목차</h2><aside><nav id=TableOfContents></nav></aside></section><article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content"><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Button</span> <span class=na>variant</span><span class=o>=</span><span class=s>&#34;contained&#34;</span> <span class=na>component</span><span class=o>=</span><span class=s>&#34;label&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=err>아이콘</span> <span class=err>업로드</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span>
</span></span><span class=line><span class=cl>    <span class=na>accept</span><span class=o>=</span><span class=s>&#34;image/*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>multiple</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>hidden</span>
</span></span><span class=line><span class=cl>    <span class=na>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span>: <span class=kt>ChangeEvent</span><span class=p>&lt;</span><span class=nt>HTMLInputElement</span><span class=p>&gt;)</span><span class=o>:</span> <span class=k>void</span> <span class=o>=&gt;</span> <span class=nx>handleUploadIcon</span><span class=p>(</span><span class=nx>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>먼저, 업로드 버튼을 만들고, 모든이미지를 허용하고, file타입으로 input태그를 만든다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleUploadIcon</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span>: <span class=kt>ChangeEvent</span><span class=p>&lt;</span><span class=nt>HTMLInputElement</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setImgFile</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>files</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>imagePromise</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>files</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>arrayBuffer</span><span class=p>().</span><span class=nx>then</span><span class=p>((</span><span class=nx>buf</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>makeImage</span><span class=p>(</span><span class=nx>buf</span><span class=p>,</span> <span class=nx>figure</span><span class=p>,</span> <span class=nx>borderColor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>imagePromise</span><span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>resized</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fileReader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileReader</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fileReader</span><span class=p>.</span><span class=nx>readAsDataURL</span><span class=p>(</span><span class=nx>resized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fileReader</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>image</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=nx>image</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>result</span> <span class=kr>as</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>      <span class=nx>image</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>base64Img</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>result</span> <span class=kr>as</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=c1>//   //! 아이콘 해쉬 변환
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=nx>CryptoJS</span><span class=p>.</span><span class=nx>SHA256</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>).</span><span class=nx>toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=nx>dataURLtoFile</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>,</span> <span class=s1>&#39;MaskedImage.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>,</span> <span class=s1>&#39;base64Img&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>hash</span><span class=p>,</span> <span class=s1>&#39;아이콘 추가&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nx>setFile</span><span class=p>(</span><span class=nx>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>makeImage함수로 이미지를 masking 그리고, dataURLtoFile 함수로 파일객체로 만들어준다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>imgFile</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>imagePromise</span> <span class=o>=</span> <span class=nx>imgFile</span><span class=p>.</span><span class=nx>arrayBuffer</span><span class=p>().</span><span class=nx>then</span><span class=p>((</span><span class=nx>buf</span>: <span class=kt>ArrayBuffer</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>makeImage</span><span class=p>(</span><span class=nx>buf</span><span class=p>,</span> <span class=nx>figure</span><span class=p>,</span> <span class=nx>borderColor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>imagePromise</span><span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>resized</span>: <span class=kt>Blob</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>fileReader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileReader</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=nx>fileReader</span><span class=p>.</span><span class=nx>readAsDataURL</span><span class=p>(</span><span class=nx>resized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>fileReader</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>image</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>image</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>result</span> <span class=kr>as</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=nx>image</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>base64Img</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>result</span> <span class=kr>as</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=nx>CryptoJS</span><span class=p>.</span><span class=nx>SHA256</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>).</span><span class=nx>toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=nx>dataURLtoFile</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>,</span> <span class=s1>&#39;MaskedImage.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>base64Img</span><span class=p>,</span> <span class=s1>&#39;base64Img&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>hash</span><span class=p>,</span> <span class=s1>&#39;아이콘 추가&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>setFile</span><span class=p>(</span><span class=nx>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[</span><span class=nx>borderImgState</span><span class=p>,</span> <span class=nx>borderColor</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>icon</span> <span class=o>&amp;&amp;</span> <span class=nx>file</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>file</span><span class=p>,</span> <span class=s1>&#39;uploadFile&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>borderImg</span><span class=p>,</span> <span class=s1>&#39;borderImgState&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>setInfo</span><span class=p>(</span><span class=nx>borderColor</span><span class=p>,</span> <span class=s1>&#39;borderColor&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[</span><span class=nx>icon</span><span class=p>,</span> <span class=nx>file</span><span class=p>])</span>
</span></span></code></pre></div><p>border가 바뀔때마다, 그리고 img가 바뀔때마다, masking 함수를 실행한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=cm>/* eslint-disable func-names */</span>
</span></span><span class=line><span class=cl><span class=cm>/* eslint-disable no-bitwise */</span>
</span></span><span class=line><span class=cl><span class=cm>/* eslint-disable no-plusplus */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Image</span> <span class=kr>as</span> <span class=nx>ImageJS</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;image-js&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>lineURL</span><span class=p>,</span> <span class=nx>pngURL</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../../components/TokenDeploy/MakeSymbol&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>BASE_SIZE</span> <span class=o>=</span> <span class=mi>640</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>makeImage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>imgBytes</span>: <span class=kt>ArrayBuffer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>templateNum</span>: <span class=kt>number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>borderColor</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 1. load image from bytes
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>originalImg</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>ImageJS</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>imgBytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>emptyArr</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Array</span><span class=p>(</span><span class=mi>640</span> <span class=o>*</span> <span class=mi>640</span> <span class=o>*</span> <span class=mi>4</span><span class=p>).</span><span class=nx>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>bg</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ImageJS</span><span class=p>(</span><span class=nx>BASE_SIZE</span><span class=p>,</span> <span class=nx>BASE_SIZE</span><span class=p>,</span> <span class=nx>emptyArr</span><span class=p>,</span> <span class=p>{</span> <span class=nx>alpha</span>: <span class=kt>1</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;original originalImg info&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>originalImg</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>originalImg</span><span class=p>.</span><span class=nx>height</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. resize image
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>xOffset</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>yOffset</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>resizedImg</span>: <span class=kt>ImageJS</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>originalImg</span><span class=p>.</span><span class=nx>width</span> <span class=o>&gt;</span> <span class=nx>originalImg</span><span class=p>.</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>resizedImg</span> <span class=o>=</span> <span class=nx>originalImg</span><span class=p>.</span><span class=nx>resize</span><span class=p>({</span> <span class=nx>width</span>: <span class=kt>BASE_SIZE</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>yOffset</span> <span class=o>=</span> <span class=p>(</span><span class=nx>BASE_SIZE</span> <span class=o>-</span> <span class=nx>resizedImg</span><span class=p>.</span><span class=nx>height</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>resizedImg</span> <span class=o>=</span> <span class=nx>originalImg</span><span class=p>.</span><span class=nx>resize</span><span class=p>({</span> <span class=nx>height</span>: <span class=kt>BASE_SIZE</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>xOffset</span> <span class=o>=</span> <span class=p>(</span><span class=nx>BASE_SIZE</span> <span class=o>-</span> <span class=nx>resizedImg</span><span class=p>.</span><span class=nx>width</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>squaredImg</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>mergeImages</span><span class=p>(</span><span class=nx>bg</span><span class=p>,</span> <span class=nx>xOffset</span><span class=p>,</span> <span class=nx>yOffset</span><span class=p>,</span> <span class=nx>resizedImg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. make maskImage
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>maskOriginal</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>makeMaskImage</span><span class=p>(</span><span class=nx>templateNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>mask</span>: <span class=kt>ImageJS</span> <span class=o>=</span> <span class=nx>maskOriginal</span>
</span></span><span class=line><span class=cl>    <span class=c1>// @ts-ignore
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>.</span><span class=nx>gray</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>mask</span><span class=p>({</span> <span class=nx>threshold</span>: <span class=kt>0.1</span><span class=p>,</span> <span class=nx>useAlpha</span>: <span class=kt>true</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 4. extract by mask
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// @ts-ignore
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>maskedImage</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>squaredImg</span><span class=p>.</span><span class=nx>extract</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=p>{</span> <span class=nx>position</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 5. draw border image
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>borderImg</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>makeBorderImage</span><span class=p>(</span><span class=nx>templateNum</span><span class=p>,</span> <span class=nx>borderColor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>borderAddedImage</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>mergeImages</span><span class=p>(</span><span class=nx>maskedImage</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>borderImg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// blob 타입으로 리턴
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nx>borderAddedImage</span><span class=p>.</span><span class=nx>toBlob</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>makeMaskImage</span><span class=p>(</span><span class=nx>templateNumber</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ImageJS</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>borderMaskFile</span> <span class=o>=</span> <span class=nx>pngURL</span><span class=p>[</span><span class=nx>templateNumber</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>maskUrl</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>borderMaskFile</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ImageJS</span><span class=p>&gt;(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>xhr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;get&#39;</span><span class=p>,</span> <span class=nx>maskUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>responseType</span> <span class=o>=</span> <span class=s1>&#39;arraybuffer&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ImageJS</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>xhr</span><span class=p>.</span><span class=nx>response</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>mask</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>resolve</span><span class=p>(</span><span class=nx>mask</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>onerror</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`failed by </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>`</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// * 색칠.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>makeBorderImage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>templateNumber</span>: <span class=kt>number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>borderColor</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ImageJS</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>rawBorderMask</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>loadBorderImage</span><span class=p>(</span><span class=nx>templateNumber</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// @ts-ignore
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>mask</span> <span class=o>=</span> <span class=nx>rawBorderMask</span><span class=p>.</span><span class=nx>gray</span><span class=p>().</span><span class=nx>mask</span><span class=p>({</span> <span class=nx>threshold</span>: <span class=kt>0.1</span><span class=p>,</span> <span class=nx>useAlpha</span>: <span class=kt>true</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>background</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ImageJS</span><span class=p>(</span><span class=nx>BASE_SIZE</span><span class=p>,</span> <span class=nx>BASE_SIZE</span><span class=p>,</span> <span class=p>[],</span> <span class=p>{</span> <span class=nx>alpha</span>: <span class=kt>1</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// @ts-ignore
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>maskedBorder</span> <span class=o>=</span> <span class=nx>background</span><span class=p>.</span><span class=nx>extract</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=p>{</span> <span class=nx>position</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>border</span> <span class=o>=</span> <span class=nx>maskedBorder</span><span class=p>.</span><span class=nx>paintMasks</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=p>{</span> <span class=nx>color</span>: <span class=kt>borderColor</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>border</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// * 이미지로드.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>loadBorderImage</span><span class=p>(</span><span class=nx>templateNumber</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ImageJS</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>borderMaskFile</span> <span class=o>=</span> <span class=nx>lineURL</span><span class=p>[</span><span class=nx>templateNumber</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>borderUrl</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>borderMaskFile</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ImageJS</span><span class=p>&gt;(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>xhr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;get&#39;</span><span class=p>,</span> <span class=nx>borderUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>responseType</span> <span class=o>=</span> <span class=s1>&#39;arraybuffer&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ImageJS</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>xhr</span><span class=p>.</span><span class=nx>response</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>mask</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>resolve</span><span class=p>(</span><span class=nx>mask</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>onerror</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`failed by </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>`</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>mergeImages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>out</span>: <span class=kt>ImageJS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>x</span>: <span class=kt>number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span>: <span class=kt>number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>toInsert</span>: <span class=kt>ImageJS</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>maxY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>out</span><span class=p>.</span><span class=nx>height</span><span class=p>,</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>toInsert</span><span class=p>.</span><span class=nx>height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>maxX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>out</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>toInsert</span><span class=p>.</span><span class=nx>width</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>out</span><span class=p>.</span><span class=nx>bitDepth</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>j</span> <span class=o>=</span> <span class=nx>y</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>maxY</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=nx>x</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>maxX</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>toInsert</span><span class=p>.</span><span class=nx>getBitXY</span><span class=p>(</span><span class=nx>i</span> <span class=o>-</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>j</span> <span class=o>-</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=nx>out</span><span class=p>.</span><span class=nx>setBitXY</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=nx>out</span><span class=p>.</span><span class=nx>clearBitXY</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>j</span> <span class=o>=</span> <span class=nx>y</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>maxY</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=nx>x</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>maxX</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>toInsert</span><span class=p>.</span><span class=nx>getPixelXY</span><span class=p>(</span><span class=nx>i</span> <span class=o>-</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>j</span> <span class=o>-</span> <span class=nx>y</span><span class=p>)[</span><span class=mi>3</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>127</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>out</span><span class=p>.</span><span class=nx>setPixelXY</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>toInsert</span><span class=p>.</span><span class=nx>getPixelXY</span><span class=p>(</span><span class=nx>i</span> <span class=o>-</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>j</span> <span class=o>-</span> <span class=nx>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>out</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>makeImage</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>dataURLtoFile</span> <span class=o>=</span> <span class=p>(</span><span class=nx>base64</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>fileName</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>arr</span> <span class=o>=</span> <span class=nx>base64</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>mime</span> <span class=o>=</span> <span class=nx>arr</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>match</span><span class=p>(</span><span class=sr>/:(.*?);/</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>bstr</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>atob</span><span class=p>(</span><span class=nx>arr</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>n</span> <span class=o>=</span> <span class=nx>bstr</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>u8arr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nx>n</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>u8arr</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span> <span class=o>=</span> <span class=nx>bstr</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>File</span><span class=p>([</span><span class=nx>u8arr</span><span class=p>],</span> <span class=sb>`</span><span class=si>${</span><span class=nx>fileName</span><span class=si>}</span><span class=sb>.png`</span><span class=p>,</span> <span class=p>{</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>mime</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>file</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></article><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-findmytrueself-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></main><footer class="flex flex-none justify-center"><section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300"><div class="flex flex-row"><a href=https://github.com/findmytrueself target=_blank title=GitHub class="flex flex-row mr-2"><span class=hidden>GitHub</span>
<i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</i></a><a href=https://instagram.com/instant.coffee_ target=_blank title=Instagram class="flex flex-row mr-2"><span class=hidden>Instagram</span>
<i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-brand-instagram" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 4a4 4 0 014-4h8a4 4 0 014 4v8a4 4 0 01-4 4H8a4 4 0 01-4-4z"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M16.5 7.5v.01"/></svg>
</i></a><a href=https://www.linkedin.com/in/findmytrueself target=_blank title=LinkedIn class="flex flex-row mr-2"><span class=hidden>LinkedIn</span>
<i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-brand-linkedin" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></i></a></div><div class=grow></div><div class="flex flex-row"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M14 9.75a3.016 3.016.0 00-4.163.173 2.993 2.993.0 000 4.154A3.016 3.016.0 0014 14.25"/></svg>
</i>2024 Im Hun</div></section></footer><script src=/main.min.65ca5b0808abf278fcec5d424701ebf0b4bc46a737129cd5e57fdb739f463e79.js></script><div class="hidden top-1 right-1" id=code-copy><i class="h-6 w-6 block"><svg class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667A2.667 2.667.0 019.667 7h8.666A2.667 2.667.0 0121 9.667v8.666A2.667 2.667.0 0118.333 21H9.667A2.667 2.667.0 017 18.333z"/><path d="M4.012 16.737A2.005 2.005.0 013 15V5c0-1.1.9-2 2-2h10c.75.0 1.158.385 1.5 1"/></svg></i></div><div class="hidden top-1 right-1" id=code-copy-done><i class="h-6 w-6 block"><svg class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5L20 7"/></svg></i></div><script src=/code-copy.min.e7b2a74adef1ed474c335c8bd5e7832b2316b8842b0f9184d65286c5bd64f51a.js></script></body></html>